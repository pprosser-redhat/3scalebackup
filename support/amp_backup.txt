Backup MySQL DB

mysqldump --skip-lock-tables -h $SYSTEM_MYSQL_SERVICE_HOST -P $SYSTEM_MYSQL_SERVICE_PORT   -u $MYSQL_USER --password="$MYSQL_PASSWORD" --all-databases > /var/lib/mysql/data/db_archive_dir/all.sql

oc rsync  system-mysql-2-49dgn:/var/lib/mysql/data/db_archive_dir .

Backup both Redis servers using similer to example below

oc rsync backend-redis-1-h8jf9:/var/lib/redis/data/appendonly.aof .
oc rsync backend-redis-1-h8jf9:/var/lib/redis/data/dump.rdb .

oc rsync system-redis-1-97p6x:/var/lib/redis/data/dump.rdb .
oc rsync system-redis-1-97p6x:/var/lib/redis/data/appendonly.aof .

Back up AMP

======= Might not need this - trying to re-create from 3SCale product template =======
oc export all -o yaml > project.yaml
oc get rolebindings -o yaml --export=true > rolebindings.yaml
oc get serviceaccount -o yaml --export=true > serviceaccount.yaml
oc get secret -o yaml --export=true > secret.yaml
oc get pvc -o yaml --export=true > pvc.yaml

Restore

oc new-project amp --description="3Scale API Management Platform"
oc new-app  --file project.yaml -p DOMAIN_NAME_SUFFIX=192.168.99.100.nip.io
oc create -f configmap.yml
oc create -f secret.yaml
oc create -f serviceaccount.yaml
oc create -f pvc.yaml
oc create -f rolebindings.yaml

Restore Mysql

Create folder called :-

/var/lib/mysql/data/db_archive_dir in the MySQL product

Copy all.sql to mysql container :-

oc rsync ~/projects/demolab/3scalebackup/3Scale_backup/db_archive_dir system-mysql-1-qtgl7:/var/lib/mysql/data

cd to the db_archive_dir, and type :-

mysql -u root

=======================
MySQL back up seems restored - on to Redis next
=======================

Restore backend redis

oc rsync ~/projects/demolab/3scalebackup/3Scale_backup/backend_redis/data backend-redis-1-6jvxh:/var/lib/redis

Restore system redis

oc rsync ~/projects/demolab/3scalebackup/3Scale_backup/system_redis/data system-redis-1-8k29m:/var/lib/redis

restart both the backend redis, and rhe system redis

=======================================================================================
