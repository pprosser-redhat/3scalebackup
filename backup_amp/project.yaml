apiVersion: v1
kind: Template
metadata:
  creationTimestamp: null
  name: project.yaml
objects:
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: apicast-production
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      deploymentconfig: apicast-production
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1800
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          deploymentconfig: apicast-production
      spec:
        containers:
        - env:
          - name: THREESCALE_PORTAL_ENDPOINT
            value: http://ohnchca2@system-provider:3000
          - name: APICAST_CONFIGURATION_LOADER
            value: lazy
          - name: APICAST_CONFIGURATION_CACHE
            value: "300"
          - name: THREESCALE_DEPLOYMENT_ENV
            value: production
          - name: APICAST_MANAGEMENT_API
            value: status
          - name: BACKEND_ENDPOINT_OVERRIDE
            value: http://backend-listener:3000
          - name: OPENSSL_VERIFY
            value: "false"
          - name: APICAST_RESPONSE_CODES
            value: "true"
          - name: REDIS_URL
            value: redis://system-redis:6379/1
          image: registry.access.redhat.com/3scale-amp21/apicast-gateway
#          image: registry.access.redhat.com/3scale-amp21/apicast-gateway@sha256:313df5722ddd866d43758af161e5932dfd4648b99a5c57acfddfc2a955669fe8
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/live
              port: 8090
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          name: apicast-production
          ports:
          - containerPort: 8080
            protocol: TCP
          - containerPort: 8090
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/ready
              port: 8090
              scheme: HTTP
            initialDelaySeconds: 15
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: apicast-staging
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      deploymentconfig: apicast-staging
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1800
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          deploymentconfig: apicast-staging
      spec:
        containers:
        - env:
          - name: THREESCALE_PORTAL_ENDPOINT
            value: http://ohnchca2@system-provider:3000
          - name: APICAST_CONFIGURATION_LOADER
            value: lazy
          - name: APICAST_CONFIGURATION_CACHE
            value: "0"
          - name: THREESCALE_DEPLOYMENT_ENV
            value: sandbox
          - name: APICAST_MANAGEMENT_API
            value: status
          - name: BACKEND_ENDPOINT_OVERRIDE
            value: http://backend-listener:3000
          - name: OPENSSL_VERIFY
            value: "false"
          - name: APICAST_RESPONSE_CODES
            value: "true"
          - name: REDIS_URL
            value: redis://system-redis:6379/2
          image: registry.access.redhat.com/3scale-amp21/apicast-gateway
#          image: registry.access.redhat.com/3scale-amp21/apicast-gateway@sha256:313df5722ddd866d43758af161e5932dfd4648b99a5c57acfddfc2a955669fe8
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/live
              port: 8090
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          name: apicast-staging
          ports:
          - containerPort: 8080
            protocol: TCP
          - containerPort: 8090
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/ready
              port: 8090
              scheme: HTTP
            initialDelaySeconds: 15
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: apicast-wildcard-router
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      deploymentconfig: apicast-wildcard-router
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1800
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          deploymentconfig: apicast-wildcard-router
      spec:
        containers:
        - env:
          - name: API_HOST
            value: http://system-provider:3000
          - name: ACCESS_TOKEN
            value: ohnchca2
          image: registry.access.redhat.com/3scale-amp21/wildcard-router
#          image: registry.access.redhat.com/3scale-amp21/wildcard-router@sha256:bb08c3f5c1e573018fa69ebb34d841ea054638744289235c6bf862c1c81b176f
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: http
            timeoutSeconds: 1
          name: apicast-wildcard-router
          ports:
          - containerPort: 8080
            name: http
            protocol: TCP
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: backend-cron
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: backend-cron
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: backend-cron
      spec:
        containers:
        - args:
          - backend-cron
          env:
          - name: CONFIG_REDIS_PROXY
            value: backend-redis:6379
          - name: CONFIG_QUEUES_MASTER_NAME
            value: backend-redis:6379/1
          - name: RACK_ENV
            value: production
          image: registry.access.redhat.com/3scale-amp21/backend
#          image: registry.access.redhat.com/3scale-amp21/backend@sha256:4de0bf86d50462a53f461ae5b57d8321d1cc4505d433071512d0427574897842
          imagePullPolicy: Always
          name: backend-cron
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: backend-listener
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: backend-listener
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: backend-listener
      spec:
        containers:
        - args:
          - bin/3scale_backend
          - start
          - -e
          - production
          - -p
          - "3000"
          - -x
          - /dev/stdout
          env:
          - name: CONFIG_REDIS_PROXY
            value: backend-redis:6379
          - name: CONFIG_QUEUES_MASTER_NAME
            value: backend-redis:6379/1
          - name: RACK_ENV
            value: production
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          image: registry.access.redhat.com/3scale-amp21/backend
#          image: registry.access.redhat.com/3scale-amp21/backend@sha256:4de0bf86d50462a53f461ae5b57d8321d1cc4505d433071512d0427574897842
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 3000
            timeoutSeconds: 1
          name: backend-listener
          ports:
          - containerPort: 3000
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /status
              port: 3000
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: backend-redis
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: backend-redis
    strategy:
      activeDeadlineSeconds: 21600
      recreateParams:
        timeoutSeconds: 600
      resources: {}
      type: Recreate
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: backend-redis
      spec:
        containers:
        - image: registry.access.redhat.com/rhscl/redis-32-rhel7:3.2
#        - image: rhscl/redis-32-rhel7:3.2
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 6379
            timeoutSeconds: 1
          name: backend-redis
          readinessProbe:
            exec:
              command:
              - container-entrypoint
              - bash
              - -c
              - redis-cli set liveness-probe "`date`" | grep OK
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/lib/redis/data
            name: backend-redis-storage
          - mountPath: /etc/redis.conf
            name: redis-config
            subPath: redis.conf
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: backend-redis-storage
          persistentVolumeClaim:
            claimName: backend-redis-storage
        - configMap:
            defaultMode: 420
            items:
            - key: redis.conf
              path: redis.conf
            name: redis-config
          name: redis-config
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: backend-worker
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: backend-worker
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: backend-worker
      spec:
        containers:
        - args:
          - bin/3scale_backend_worker
          - run
          env:
          - name: CONFIG_REDIS_PROXY
            value: backend-redis:6379
          - name: CONFIG_QUEUES_MASTER_NAME
            value: backend-redis:6379/1
          - name: RACK_ENV
            value: production
          - name: CONFIG_EVENTS_HOOK
            value: http://system-provider:3000/master/events/import
          - name: CONFIG_EVENTS_HOOK_SHARED_SECRET
            value: 084qnjji
          image: registry.access.redhat.com/3scale-amp21/backend
#          image: registry.access.redhat.com/3scale-amp21/backend@sha256:4de0bf86d50462a53f461ae5b57d8321d1cc4505d433071512d0427574897842
          imagePullPolicy: Always
          name: backend-worker
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-app
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-app
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        post:
          execNewPod:
            command:
            - bash
            - -c
            - bundle exec rake boot openshift:post_deploy
            containerName: system-provider
          failurePolicy: Abort
        pre:
          execNewPod:
            command:
            - bash
            - -c
            - bundle exec rake boot openshift:deploy
            containerName: system-provider
            env:
            - name: RAILS_ENV
              value: production
            - name: DATABASE_URL
              value: mysql2://root:5sgo1wvm@system-mysql/system
            - name: FORCE_SSL
              value: "true"
            - name: THREESCALE_SUPERDOMAIN
              value: ${DOMAIN_NAME_SUFFIX}
            - name: TENANT_NAME
              value: 3scale
            - name: APICAST_ACCESS_TOKEN
              value: ohnchca2
            - name: ADMIN_ACCESS_TOKEN
              value: a6c778iyvfi8bxa3
            - name: PROVIDER_PLAN
              value: enterprise
            - name: USER_LOGIN
              value: admin
            - name: USER_PASSWORD
              value: 7ymhr3cu
            - name: RAILS_LOG_TO_STDOUT
              value: "true"
            - name: RAILS_LOG_LEVEL
              value: info
            - name: THINKING_SPHINX_ADDRESS
              value: system-sphinx
            - name: THINKING_SPHINX_PORT
              value: "9306"
            - name: THINKING_SPHINX_CONFIGURATION_FILE
              value: /tmp/sphinx.conf
            - name: EVENTS_SHARED_SECRET
              value: 084qnjji
            - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
              value: VERIFY_NONE
            - name: APICAST_BACKEND_ROOT_ENDPOINT
              value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
            - name: CONFIG_INTERNAL_API_USER
              value: 3scale_api_user
            - name: CONFIG_INTERNAL_API_PASSWORD
              value: yrwkkmu6
            - name: SECRET_KEY_BASE
              value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
            - name: ZYNC_AUTHENTICATION_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ZYNC_AUTHENTICATION_TOKEN
                  name: zync
            - name: SMTP_ADDRESS
              valueFrom:
                configMapKeyRef:
                  key: address
                  name: smtp
            - name: SMTP_USER_NAME
              valueFrom:
                configMapKeyRef:
                  key: username
                  name: smtp
            - name: SMTP_PASSWORD
              valueFrom:
                configMapKeyRef:
                  key: password
                  name: smtp
            - name: SMTP_DOMAIN
              valueFrom:
                configMapKeyRef:
                  key: domain
                  name: smtp
            - name: SMTP_PORT
              valueFrom:
                configMapKeyRef:
                  key: port
                  name: smtp
            - name: SMTP_AUTHENTICATION
              valueFrom:
                configMapKeyRef:
                  key: authentication
                  name: smtp
            - name: SMTP_OPENSSL_VERIFY_MODE
              valueFrom:
                configMapKeyRef:
                  key: openssl.verify.mode
                  name: smtp
            - name: BACKEND_ROUTE
              value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
            - name: SSL_CERT_DIR
              value: /etc/pki/tls/certs
            volumes:
            - system-storage
          failurePolicy: Retry
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-app
      spec:
        containers:
        - command:
          - env
          - TENANT_MODE=provider
          - PORT=3000
          - container-entrypoint
          - bundle
          - exec
          - unicorn
          - -c
          - config/unicorn.rb
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: FORCE_SSL
            value: "false"
          - name: THREESCALE_SUPERDOMAIN
            value: ${DOMAIN_NAME_SUFFIX}
          - name: TENANT_NAME
            value: 3scale
          - name: APICAST_ACCESS_TOKEN
            value: ohnchca2
          - name: ADMIN_ACCESS_TOKEN
            value: a6c778iyvfi8bxa3
          - name: PROVIDER_PLAN
            value: enterprise
          - name: USER_LOGIN
            value: admin
          - name: USER_PASSWORD
            value: 7ymhr3cu
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_LOG_LEVEL
            value: info
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_PORT
            value: "9306"
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            value: 084qnjji
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            value: VERIFY_NONE
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          - name: SECRET_KEY_BASE
            value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: BACKEND_ROUTE
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: SSL_CERT_DIR
            value: /etc/pki/tls/certs
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 20
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: provider
            timeoutSeconds: 10
          name: system-provider
          ports:
          - containerPort: 3000
            name: provider
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              httpHeaders:
              - name: X-Forwarded-Proto
                value: https
              path: /check.txt
              port: provider
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 10
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
          - mountPath: /opt/system/config/zync.yml
            name: system-config
            subPath: zync.yml
          - mountPath: /opt/system/config/rolling_updates.yml
            name: system-config
            subPath: rolling_updates.yml
        - command:
          - env
          - TENANT_MODE=developer
          - PORT=3001
          - container-entrypoint
          - bundle
          - exec
          - unicorn
          - -c
          - config/unicorn.rb
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: FORCE_SSL
            value: "true"
          - name: THREESCALE_SUPERDOMAIN
            value: ${DOMAIN_NAME_SUFFIX}
          - name: TENANT_NAME
            value: 3scale
          - name: APICAST_ACCESS_TOKEN
            value: ohnchca2
          - name: ADMIN_ACCESS_TOKEN
            value: a6c778iyvfi8bxa3
          - name: PROVIDER_PLAN
            value: enterprise
          - name: USER_LOGIN
            value: admin
          - name: USER_PASSWORD
            value: 7ymhr3cu
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_LOG_LEVEL
            value: info
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_PORT
            value: "9306"
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            value: 084qnjji
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            value: VERIFY_NONE
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          - name: SECRET_KEY_BASE
            value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: BACKEND_ROUTE
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: SSL_CERT_DIR
            value: /etc/pki/tls/certs
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 20
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: developer
            timeoutSeconds: 10
          name: system-developer
          ports:
          - containerPort: 3001
            name: developer
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              httpHeaders:
              - name: X-Forwarded-Proto
                value: https
              path: /check.txt
              port: developer
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 10
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
            readOnly: true
          - mountPath: /opt/system/config/zync.yml
            name: system-config
            subPath: zync.yml
          - mountPath: /opt/system/config/rolling_updates.yml
            name: system-config
            subPath: rolling_updates.yml
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: system-storage
          persistentVolumeClaim:
            claimName: system-storage
        - configMap:
            defaultMode: 420
            items:
            - key: zync.yml
              path: zync.yml
            - key: rolling_updates.yml
              path: rolling_updates.yml
            name: system
          name: system-config
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-memcache
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-memcache
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-memcache
      spec:
        containers:
        - command:
          - memcached
          - -m
          - "64"
          image: registry.access.redhat.com/3scale-amp20/memcached:1.4.15-8
#          image: 3scale-amp20/memcached:1.4.15-8
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 11211
            timeoutSeconds: 1
          name: memcache
          readinessProbe:
            exec:
              command:
              - sh
              - -c
              - echo version | nc $HOSTNAME 11211 | grep VERSION
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-mysql
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-mysql
    strategy:
      activeDeadlineSeconds: 21600
      recreateParams:
        timeoutSeconds: 600
      resources: {}
      type: Recreate
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-mysql
      spec:
        containers:
        - env:
          - name: MYSQL_USER
            value: mysql
          - name: MYSQL_PASSWORD
            value: yp5w0ast
          - name: MYSQL_DATABASE
            value: system
          - name: MYSQL_ROOT_PASSWORD
            value: 5sgo1wvm
          - name: MYSQL_LOWER_CASE_TABLE_NAMES
            value: "1"
          image: registry.access.redhat.com/rhscl/mysql-57-rhel7
#          image: rhscl/mysql-56-rhel7:5.6
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 3306
            timeoutSeconds: 1
          name: system-mysql
          ports:
          - containerPort: 3306
            protocol: TCP
          readinessProbe:
            exec:
              command:
              - /bin/sh
              - -i
              - -c
              - MYSQL_PWD="$MYSQL_PASSWORD" mysql -h 127.0.0.1 -u $MYSQL_USER -D $MYSQL_DATABASE
                -e 'SELECT 1'
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 5
          resources:
            limits:
              memory: 2Gi
            requests:
              cpu: "1"
              memory: 1Gi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/lib/mysql/data
            name: mysql-storage
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: mysql-storage
          persistentVolumeClaim:
            claimName: mysql-storage
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-redis
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-redis
    strategy:
      activeDeadlineSeconds: 21600
      recreateParams:
        timeoutSeconds: 600
      resources: {}
      type: Recreate
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-redis
      spec:
        containers:
        - image: registry.access.redhat.com/rhscl/redis-32-rhel7
#        - image: rhscl/redis-32-rhel7:3.2
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            tcpSocket:
              port: 6379
            timeoutSeconds: 1
          name: system-redis
          readinessProbe:
            exec:
              command:
              - container-entrypoint
              - bash
              - -c
              - redis-cli set liveness-probe "`date`" | grep OK
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/lib/redis/data
            name: system-redis-storage
          - mountPath: /etc/redis.conf
            name: redis-config
            subPath: redis.conf
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: system-redis-storage
          persistentVolumeClaim:
            claimName: system-redis-storage
        - configMap:
            defaultMode: 420
            items:
            - key: redis.conf
              path: redis.conf
            name: redis-config
          name: redis-config
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-resque
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-resque
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-resque
      spec:
        containers:
        - args:
          - rake
          - resque:work
          - QUEUE=*
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: FORCE_SSL
            value: "true"
          - name: THREESCALE_SUPERDOMAIN
            value: ${DOMAIN_NAME_SUFFIX}
          - name: TENANT_NAME
            value: 3scale
          - name: APICAST_ACCESS_TOKEN
            value: ohnchca2
          - name: ADMIN_ACCESS_TOKEN
            value: a6c778iyvfi8bxa3
          - name: PROVIDER_PLAN
            value: enterprise
          - name: USER_LOGIN
            value: admin
          - name: USER_PASSWORD
            value: 7ymhr3cu
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_LOG_LEVEL
            value: info
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_PORT
            value: "9306"
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            value: 084qnjji
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            value: VERIFY_NONE
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          - name: SECRET_KEY_BASE
            value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: BACKEND_ROUTE
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: SSL_CERT_DIR
            value: /etc/pki/tls/certs
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          name: system-resque
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
        - args:
          - rake
          - resque:scheduler
          - QUEUE=*
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: FORCE_SSL
            value: "true"
          - name: THREESCALE_SUPERDOMAIN
            value: ${DOMAIN_NAME_SUFFIX}
          - name: TENANT_NAME
            value: 3scale
          - name: APICAST_ACCESS_TOKEN
            value: ohnchca2
          - name: ADMIN_ACCESS_TOKEN
            value: a6c778iyvfi8bxa3
          - name: PROVIDER_PLAN
            value: enterprise
          - name: USER_LOGIN
            value: admin
          - name: USER_PASSWORD
            value: 7ymhr3cu
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_LOG_LEVEL
            value: info
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_PORT
            value: "9306"
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            value: 084qnjji
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            value: VERIFY_NONE
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          - name: SECRET_KEY_BASE
            value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: BACKEND_ROUTE
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: SSL_CERT_DIR
            value: /etc/pki/tls/certs
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          name: system-scheduler
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: system-storage
          persistentVolumeClaim:
            claimName: system-storage
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-sidekiq
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-sidekiq
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-sidekiq
      spec:
        containers:
        - args:
          - rake
          - sidekiq:worker
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: FORCE_SSL
            value: "true"
          - name: THREESCALE_SUPERDOMAIN
            value: ${DOMAIN_NAME_SUFFIX}
          - name: TENANT_NAME
            value: 3scale
          - name: APICAST_ACCESS_TOKEN
            value: ohnchca2
          - name: ADMIN_ACCESS_TOKEN
            value: a6c778iyvfi8bxa3
          - name: PROVIDER_PLAN
            value: enterprise
          - name: USER_LOGIN
            value: admin
          - name: USER_PASSWORD
            value: 7ymhr3cu
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_LOG_LEVEL
            value: info
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_PORT
            value: "9306"
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            value: 084qnjji
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            value: VERIFY_NONE
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: CONFIG_INTERNAL_API_USER
            value: 3scale_api_user
          - name: CONFIG_INTERNAL_API_PASSWORD
            value: yrwkkmu6
          - name: SECRET_KEY_BASE
            value: 314c7b1dab2eaa10d54d57e8a887042d5e5ad41220153d3eeb7123ea1843c2643d3c4d6a4cd6daa8b2caa46d72d7ba0a618d03853ae478e53c8488d4b82a2b26
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: BACKEND_ROUTE
            value: https://backend-3scale.${DOMAIN_NAME_SUFFIX}
          - name: SSL_CERT_DIR
            value: /etc/pki/tls/certs
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          name: system-sidekiq
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
          - mountPath: /opt/system/config/zync.yml
            name: system-config
            subPath: zync.yml
          - mountPath: /opt/system/config/rolling_updates.yml
            name: system-config
            subPath: rolling_updates.yml
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - name: system-storage
          persistentVolumeClaim:
            claimName: system-storage
        - configMap:
            defaultMode: 420
            items:
            - key: zync.yml
              path: zync.yml
            - key: rolling_updates.yml
              path: rolling_updates.yml
            name: system
          name: system-config
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: system-sphinx
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: system-sphinx
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: system-sphinx
      spec:
        containers:
        - args:
          - rake
          - openshift:thinking_sphinx:start
          env:
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            value: mysql2://root:5sgo1wvm@system-mysql/system
          - name: THINKING_SPHINX_ADDRESS
            value: 0.0.0.0
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: db/sphinx/production.conf
          - name: THINKING_SPHINX_PID_FILE
            value: db/sphinx/searchd.pid
          - name: DELTA_INDEX_INTERVAL
            value: "5"
          - name: FULL_REINDEX_INTERVAL
            value: "60"
          image: registry.access.redhat.com/3scale-amp21/system
#          image: registry.access.redhat.com/3scale-amp21/system@sha256:41784ca2715495f9a12fd00763391847400a8d5d5a21ccba51ed47088e26ffb1
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 60
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 9306
            timeoutSeconds: 1
          name: system-sphinx
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /opt/system/db/sphinx
            name: system-sphinx-database
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: system-sphinx-database
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    labels:
      app: zync
    name: zync
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      app: zync
      deploymentconfig: zync
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          app: zync
          deploymentconfig: zync
      spec:
        containers:
        - env:
          - name: RAILS_LOG_TO_STDOUT
            value: "true"
          - name: RAILS_ENV
            value: production
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: DATABASE_URL
                name: zync
          - name: SECRET_KEY_BASE
            valueFrom:
              secretKeyRef:
                key: SECRET_KEY_BASE
                name: zync
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          image: registry.access.redhat.com/3scale-amp21/zync
#          image: registry.access.redhat.com/3scale-amp21/zync@sha256:8cdf36d177e81c9e4c3a17950c94245bb662249374d1385231afd63da225a617
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/live
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 60
          name: zync
          ports:
          - containerPort: 8080
            protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /status/ready
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 10
          resources:
            limits:
              cpu: "1"
              memory: 250Mi
            requests:
              cpu: 250m
              memory: 150M
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    generation: 1
    name: zync-database
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      name: zync-database
    strategy:
      activeDeadlineSeconds: 21600
      recreateParams:
        timeoutSeconds: 600
      resources: {}
      type: Recreate
    template:
      metadata:
        annotations:
          openshift.io/generated-by: OpenShiftNewApp
        creationTimestamp: null
        labels:
          name: zync-database
      spec:
        containers:
        - env:
          - name: POSTGRESQL_USER
            value: zync
          - name: POSTGRESQL_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ZYNC_DATABASE_PASSWORD
                name: zync
          - name: POSTGRESQL_DATABASE
            value: zync_production
          image: registry.access.redhat.com/rhscl/postgresql-95-rhel7
#          image: registry.access.redhat.com/rhscl/postgresql-95-rhel7@sha256:20ae2acdccba2b970d9ddee68e60bda81c38c87154cddce15255aa2813fbc164
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 5432
            timeoutSeconds: 1
          name: postgresql
          ports:
          - containerPort: 5432
            protocol: TCP
          readinessProbe:
            exec:
              command:
              - /bin/sh
              - -i
              - -c
              - psql -h 127.0.0.1 -U zync -q -d zync_production -c 'SELECT 1'
            failureThreshold: 3
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              memory: 2G
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/lib/pgsql/data
            name: zync-database-data
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: zync-database-data
    test: false
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: apicast-production
    name: api-apicast-production-route
  spec:
    host: api-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: apicast-production
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:44Z
        status: "True"
        type: Admitted
      host: api-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: apicast-staging
    name: api-apicast-staging-route
  spec:
    host: api-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: apicast-staging
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:44Z
        status: "True"
        type: Admitted
      host: api-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: apicast-production-membersapp
  spec:
    host: membersregistrationservice-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-production
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-02T09:24:46Z
        status: "True"
        type: Admitted
      host: membersregistrationservice-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: apicast-production-membersapp-oauth
  spec:
    host: membersregistrationservice-oauth-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-production
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-02T15:02:59Z
        status: "True"
        type: Admitted
      host: membersregistrationservice-oauth-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: apicast-staging-members
  spec:
    host: membersregistrationservice-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-staging
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-02T09:31:03Z
        status: "True"
        type: Admitted
      host: membersregistrationservice-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: apicast-staging-members-oauth
  spec:
    host: membersregistrationservice-oauth-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-staging
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-02T15:01:05Z
        status: "True"
        type: Admitted
      host: membersregistrationservice-oauth-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: apicast-wildcard-router
    name: apicast-wildcard-router-route
  spec:
    host: apicast-wildcard.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: http
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: apicast-wildcard-router
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:44Z
        status: "True"
        type: Admitted
      host: apicast-wildcard.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: system-route
    name: backend-route
  spec:
    host: backend-3scale.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: http
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: backend-listener
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:43Z
        status: "True"
        type: Admitted
      host: backend-3scale.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: fis-demo-apicast-production
  spec:
    host: fisdemo-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-production
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-27T09:22:04Z
        status: "True"
        type: Admitted
      host: fisdemo-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: fis-demo-apicast-production-oauth
  spec:
    host: oauth-fisdemo-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-production
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-27T12:46:30Z
        status: "True"
        type: Admitted
      host: oauth-fisdemo-3scale-apicast-production.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: fisdemo-apicast-staging
  spec:
    host: fisdemo-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-staging
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-27T09:24:08Z
        status: "True"
        type: Admitted
      host: fisdemo-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    name: fisdemo-apicast-staging-oauth
  spec:
    host: oauth-fisdemo-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: gateway
    tls:
      termination: edge
    to:
      kind: Service
      name: apicast-staging
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-27T12:48:03Z
        status: "True"
        type: Admitted
      host: oauth-fisdemo-3scale-apicast-staging.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: system-route
    name: system-developer-route
  spec:
    host: 3scale.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: http
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: system-developer
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:43Z
        status: "True"
        type: Admitted
      host: 3scale.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Route
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    labels:
      app: system-route
    name: system-provider-admin-route
  spec:
    host: 3scale-admin.${DOMAIN_NAME_SUFFIX}
    port:
      targetPort: http
    tls:
      insecureEdgeTerminationPolicy: Allow
      termination: edge
    to:
      kind: Service
      name: system-provider
      weight: 100
    wildcardPolicy: None
  status:
    ingress:
    - conditions:
      - lastTransitionTime: 2018-02-01T14:35:43Z
        status: "True"
        type: Admitted
      host: 3scale-admin.${DOMAIN_NAME_SUFFIX}
      routerName: router
      wildcardPolicy: None
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
      service.alpha.openshift.io/dependencies: '[{"name": "apicast-staging", "kind":
        "Service"}]'
    creationTimestamp: null
    name: apicast-production
  spec:
    ports:
    - name: gateway
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: management
      port: 8090
      protocol: TCP
      targetPort: 8090
    selector:
      deploymentconfig: apicast-production
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: apicast-staging
  spec:
    ports:
    - name: gateway
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: management
      port: 8090
      protocol: TCP
      targetPort: 8090
    selector:
      deploymentconfig: apicast-staging
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: apicast-wildcard-router
  spec:
    ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
    selector:
      deploymentconfig: apicast-wildcard-router
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
      service.alpha.openshift.io/dependencies: '[{"name": "backend-redis", "kind":
        "Service"}]'
    creationTimestamp: null
    name: backend-listener
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: 3000
    selector:
      name: backend-listener
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: backend-redis
  spec:
    ports:
    - port: 6379
      protocol: TCP
      targetPort: 6379
    selector:
      name: backend-redis
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      gluster.kubernetes.io/provisioned-for-pvc: backend-redis-storage
    name: glusterfs-dynamic-backend-redis-storage
  spec:
    ports:
    - port: 1
      protocol: TCP
      targetPort: 1
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      gluster.kubernetes.io/provisioned-for-pvc: mysql-storage
    name: glusterfs-dynamic-mysql-storage
  spec:
    ports:
    - port: 1
      protocol: TCP
      targetPort: 1
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      gluster.kubernetes.io/provisioned-for-pvc: system-redis-storage
    name: glusterfs-dynamic-system-redis-storage
  spec:
    ports:
    - port: 1
      protocol: TCP
      targetPort: 1
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      gluster.kubernetes.io/provisioned-for-pvc: system-storage
    name: glusterfs-dynamic-system-storage
  spec:
    ports:
    - port: 1
      protocol: TCP
      targetPort: 1
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: system-developer
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: developer
    selector:
      name: system-app
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: system-memcache
  spec:
    ports:
    - name: memcache
      port: 11211
      protocol: TCP
      targetPort: 11211
    selector:
      name: system-memcache
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: system-mysql
  spec:
    ports:
    - name: system-mysql
      port: 3306
      protocol: TCP
      targetPort: 3306
    selector:
      name: system-mysql
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
      service.alpha.openshift.io/dependencies: '[{"name": "system-developer", "kind":
        "Service"}]'
    creationTimestamp: null
    name: system-provider
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: provider
    selector:
      name: system-app
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: system-redis
  spec:
    ports:
    - name: redis
      port: 6379
      protocol: TCP
      targetPort: 6379
    selector:
      name: system-redis
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: system-sphinx
  spec:
    ports:
    - name: sphinx
      port: 9306
      protocol: TCP
      targetPort: 9306
    selector:
      name: system-sphinx
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
      service.alpha.openshift.io/dependencies: '[{"name": "zync-database", "kind":
        "Service"}]'
    creationTimestamp: null
    labels:
      app: zync
    name: zync
  spec:
    ports:
    - name: 8080-tcp
      port: 8080
      protocol: TCP
      targetPort: 8080
    selector:
      app: zync
      deploymentconfig: zync
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      openshift.io/generated-by: OpenShiftNewApp
    creationTimestamp: null
    name: zync-database
  spec:
    ports:
    - name: postgresql
      port: 5432
      protocol: TCP
      targetPort: 5432
    selector:
      name: zync-database
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
parameters:
  - description: Domain name suffix - added to all routes
    displayName: Domain Name Suffix
    name: DOMAIN_NAME_SUFFIX
    value: apps.demolab.local
